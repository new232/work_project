<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ğŸ“ GPS + ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì „ì²´ ì£¼ì†Œ ì…ë ¥</title>
    <style>
        body { font-family: sans-serif; padding: 30px; }
        input { padding: 10px; width: 350px; margin-bottom: 10px; display: block; }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #getLocationBtn { background: #4caf50; color: white; }
        #micBtn { background: #f50057; color: white; }
    </style>
</head>
<body>

<h2>ğŸ“Œ GPS + ìŒì„± ì¸ì‹ìœ¼ë¡œ ì „ì²´ ì£¼ì†Œ ì…ë ¥</h2>

<input type="text" id="roadAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œ (GPS)" readonly />
<input type="text" id="detailAddress" placeholder="ìƒì„¸ ì£¼ì†Œ (ìŒì„± ì¸ì‹)" />
<input type="text" id="fullAddress" placeholder="ì „ì²´ ì£¼ì†Œ ìë™ êµ¬ì„±" readonly />

<button id="getLocationBtn">ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì£¼ì†Œ</button>
<button id="micBtn">ğŸ™ï¸ ìƒì„¸ ì£¼ì†Œ ë§í•˜ê¸°</button>

<script>
    const roadAddressInput = document.getElementById("roadAddress");
    const detailAddressInput = document.getElementById("detailAddress");
    const fullAddressInput = document.getElementById("fullAddress");

    // 1. GPS â†’ ë„ë¡œëª… ì£¼ì†Œ (Nominatim)
    document.getElementById("getLocationBtn").onclick = () => {
        if (!navigator.geolocation) {
            alert("GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            return;
        }

        navigator.geolocation.getCurrentPosition(async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            console.log("ğŸ›°ï¸ ìœ„ë„:", lat, "ê²½ë„:", lon);

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
                const data = await response.json();

                const address = data.display_name;
                if (address) {
                    roadAddressInput.value = address;
                    updateFullAddress();
                    alert("âœ… ë„ë¡œëª… ì£¼ì†Œ ì…ë ¥ ì™„ë£Œ!");
                } else {
                    alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            } catch (err) {
                alert("API í˜¸ì¶œ ì‹¤íŒ¨: " + err.message);
            }
        }, (err) => {
            alert("ìœ„ì¹˜ ì •ë³´ ì˜¤ë¥˜: " + err.message);
        });
    };

    // 2. ìŒì„± ì¸ì‹ìœ¼ë¡œ ìƒì„¸ ì£¼ì†Œ ì…ë ¥
    const micBtn = document.getElementById("micBtn");
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = "ko-KR";
    recognition.interimResults = false;

    micBtn.onclick = () => {
        recognition.start();
    };

    recognition.onresult = (event) => {
        const detail = event.results[0][0].transcript;
        detailAddressInput.value = detail;
        updateFullAddress();
        alert(`ğŸ¤ ì¸ì‹ëœ ìƒì„¸ ì£¼ì†Œ: ${detail}`);
    };

    recognition.onerror = (e) => {
        alert("ìŒì„± ì¸ì‹ ì˜¤ë¥˜: " + e.error);
    };

    // 3. ì „ì²´ ì£¼ì†Œ ì—…ë°ì´íŠ¸
    function updateFullAddress() {
        const road = roadAddressInput.value.trim();
        const detail = detailAddressInput.value.trim();
        if (road || detail) {
            fullAddressInput.value = `${road} ${detail}`.trim();
        }
    }
</script>

</body>
</html>
